You should have a separate thread with a buffer for:
- Recieved messages
- Unsent messages